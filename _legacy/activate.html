<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aktivasi Akun - DKotoba</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Storage -->
    <script src="assets/js/storage.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: {
                        primary: {
                            50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa',
                            500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full" x-data="activateApp()">
        <div class="bg-white rounded-[2.5rem] p-8 md:p-10 shadow-2xl border border-white/50 relative overflow-hidden">
            <!-- Header -->
            <div class="text-center mb-10">
                <div
                    class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center text-blue-600 font-bold text-2xl mx-auto mb-6 shadow-sm">
                    üîê
                </div>
                <h1 class="text-2xl font-black text-slate-800 mb-2">Aktivasi Akun</h1>
                <p class="text-slate-500">Buat password baru untuk mengaktifkan akun lamamu.</p>
            </div>

            <!-- Form -->
            <form @submit.prevent="submitActivation" class="space-y-6">
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-2">Password Baru</label>
                    <input type="password" x-model="password" required
                        class="w-full px-4 py-3.5 rounded-xl border border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 outline-none transition-all font-semibold"
                        placeholder="Minimal 6 karakter">
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-2">Konfirmasi Password</label>
                    <input type="password" x-model="confirmPassword" required
                        class="w-full px-4 py-3.5 rounded-xl border border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 outline-none transition-all font-semibold"
                        placeholder="Ulangi password">
                </div>

                <div x-show="msg"
                    :class="isError ? 'bg-red-50 text-red-600 border-red-100' : 'bg-green-50 text-green-600 border-green-100'"
                    class="p-4 rounded-xl text-sm font-semibold border" x-text="msg"></div>

                <button type="submit" :disabled="loading"
                    class="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-xl active:scale-[0.98] transition-all disabled:opacity-50">
                    <span x-text="loading ? 'Memproses...' : 'Aktifkan Akun'"></span>
                </button>
            </form>

            <div class="mt-8 text-center">
                <a href="auth.html" class="text-slate-400 font-bold hover:text-slate-600 transition-colors">Kembali ke
                    Login</a>
            </div>
        </div>
    </div>

    <script>
        function activateApp() {
            return {
                password: '',
                confirmPassword: '',
                msg: '',
                isError: false,
                loading: false,

                async submitActivation() {
                    const uid = localStorage.getItem('activate_uid');
                    if (!uid) {
                        this.isError = true;
                        this.msg = 'Sesi aktivasi kadaluarsa. Silakan login kembali.';
                        return;
                    }

                    if (this.password.length < 6) {
                        this.isError = true;
                        this.msg = 'Password minimal 6 karakter.';
                        return;
                    }

                    if (this.password !== this.confirmPassword) {
                        this.isError = true;
                        this.msg = 'Konfirmasi password tidak cocok.';
                        return;
                    }

                    this.loading = true;
                    this.msg = 'Menyimpan password baru...';
                    this.isError = false;

                    try {
                        const firestore = firebase.firestore();
                        await firestore.collection('users').doc(uid).update({
                            password: this.password
                        });

                        this.msg = 'Akun BERHASIL diaktifkan! Mengalihkan...';
                        localStorage.removeItem('activate_uid');

                        setTimeout(() => {
                            window.location.href = 'auth.html';
                        }, 2000);

                    } catch (e) {
                        console.error(e);
                        this.isError = true;
                        this.msg = 'Gagal mengaktifkan akun: ' + e.message;
                        this.loading = false;
                    }
                }
            }
        }
    </script>
</body>

</html>
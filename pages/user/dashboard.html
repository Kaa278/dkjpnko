<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siswa Dashboard - DKotoba</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a'
                        },
                        secondary: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a'
                        },
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'fade-in': 'fade-in 0.5s ease-out',
                    },
                    keyframes: {
                        'float': {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        'fade-in': {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 }
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script src="../../assets/js/storage.js"></script>
    <style>
        [x-cloak] {
            display: none !important;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .dark .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-input {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 1rem center;
            background-size: 1.25rem;
        }
    </style>
</head>

<body
    class="bg-gradient-to-br from-slate-50 via-white to-blue-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 text-slate-800 dark:text-slate-200 font-sans h-screen overflow-hidden transition-colors duration-300"
    x-data="userDashboard()" x-init="initDashboard()" :class="{ 'dark': darkMode }">

    <!-- Auth Check -->


    <!-- Main Layout -->
    <div class="flex h-full relative">
        <!-- Persistent Sidebar for Desktop -->
        <aside
            class="hidden md:flex flex-col w-72 h-full bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl border-r border-slate-200/50 dark:border-slate-700/50 relative z-20">
            <!-- Sidebar Header -->
            <div class="p-6 bg-gradient-to-r from-blue-600 to-indigo-600">
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <div class="w-10 h-10 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
                            <span class="text-xl font-black text-white">D</span>
                        </div>
                    </div>
                    <div>
                        <h1 class="text-lg font-black text-white tracking-tight">DKotoba</h1>
                        <p class="text-xs text-white/80 font-medium">Siswa Panel</p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
                <template x-for="item in navItems" :key="item.id">
                    <a href="#" @click.prevent="currentView = item.id"
                        :class="currentView === item.id 
                            ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 font-bold' 
                            : 'text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-slate-900 dark:hover:text-slate-200 font-medium'"
                        class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group">
                        <div class="w-6 h-6 flex items-center justify-center transition-colors"
                            :class="currentView === item.id ? 'text-blue-600 dark:text-blue-400' : 'text-slate-400 group-hover:text-slate-600 dark:group-hover:text-slate-300'">
                            <span x-html="item.icon"></span>
                        </div>
                        <span x-text="item.label"></span>
                        <div x-show="currentView === item.id"
                            class="ml-auto w-1.5 h-1.5 rounded-full bg-blue-600 dark:bg-blue-400"></div>
                    </a>
                </template>
            </nav>

            <!-- User Footer -->
            <div class="p-4 border-t border-slate-200/50 dark:border-slate-700/50 space-y-2">
                <button @click="currentView = 'setting'"
                    :class="currentView === 'setting' 
                        ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 font-bold' 
                        : 'text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-slate-900 dark:hover:text-slate-200 font-medium'"
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span class="text-sm">Profil Saya</span>
                </button>

                <button @click="logout()"
                    class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    <span class="font-semibold text-sm">Keluar</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col h-full min-w-0 overflow-hidden relative">

            <!-- Topbar -->
            <header
                class="h-20 flex items-center justify-between px-8 border-b border-slate-200/50 dark:border-slate-700/50 bg-white/50 dark:bg-slate-800/50 backdrop-blur-sm sticky top-0 z-10">
                <div>
                    <h2 class="text-xl font-bold text-slate-800 dark:text-slate-200"
                        x-text="navItems.find(i => i.id === currentView)?.label"></h2>
                    <p class="text-xs text-slate-500 dark:text-slate-400">Selamat datang kembali, <span
                            x-text="currentUser.fullName || currentUser.username"></span></p>
                </div>

                <div class="flex items-center gap-4">
                    <!-- Theme Toggle -->
                    <button @click="toggleTheme()"
                        class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-500 transition-colors">
                        <svg x-show="!darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                        <svg x-show="darkMode" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </button>

                    <!-- Profile Dropdown -->
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open"
                            class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-500 to-indigo-500 flex items-center justify-center text-white font-bold shadow-lg shadow-blue-500/30 hover:shadow-xl transition-all active:scale-95">
                            <span
                                x-text="(currentUser.fullName || currentUser.username).charAt(0).toUpperCase()"></span>
                        </button>

                        <!-- Dropdown Menu -->
                        <div x-show="open" @click.away="open = false" x-transition.origin.top.right
                            class="absolute right-0 mt-3 w-48 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-100 dark:border-slate-700 py-2 z-50 overflow-hidden">
                            <div class="px-4 py-3 border-b border-slate-100 dark:border-slate-700">
                                <p class="text-sm font-bold text-slate-800 dark:text-slate-200"
                                    x-text="currentUser.username"></p>
                                <p class="text-xs text-slate-500 truncate" x-text="currentUser.role"></p>
                            </div>
                            <a href="#" @click.prevent="currentView = 'setting'; open = false"
                                class="block px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
                                Pengaturan
                            </a>
                            <a href="#" @click.prevent="logout()"
                                class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors font-medium">
                                Keluar
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Scrollable Content -->
            <main class="flex-1 overflow-y-auto px-4 pt-4 md:p-8 pb-32 md:pb-8 relative scrollbar-thin">

                <!-- Background decoration -->
                <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
                    <div
                        class="absolute top-[20%] right-[10%] w-[500px] h-[500px] bg-blue-400/10 rounded-full mix-blend-multiply dark:mix-blend-screen filter blur-3xl opacity-50 animate-float">
                    </div>
                    <div class="absolute bottom-[20%] left-[10%] w-[400px] h-[400px] bg-indigo-400/10 rounded-full mix-blend-multiply dark:mix-blend-screen filter blur-3xl opacity-50 animate-float"
                        style="animation-delay: 2s"></div>
                </div>

                <div class="max-w-6xl mx-auto">

                    <!-- VIEW: DASHBOARD -->
                    <div x-show="currentView === 'dashboard'" x-transition.opacity class="space-y-8">
                        <!-- Welcome Card -->
                        <div
                            class="relative overflow-hidden rounded-3xl bg-gradient-to-r from-blue-600 to-indigo-600 p-8 text-white shadow-xl shadow-blue-500/20">
                            <div class="relative z-10 max-w-2xl">
                                <h2 class="text-3xl font-black mb-2">Ayo belajar hari ini! üöÄ</h2>
                                <p class="text-blue-100 mb-6">Lanjutkan progres belajarmu. Sedikit demi sedikit
                                    lama-lama menjadi bukit.</p>
                                <button @click="currentView = 'soal'"
                                    class="bg-white text-blue-600 px-6 py-2.5 rounded-full font-bold hover:bg-blue-50 transition shadow-lg active:scale-95">
                                    Mulai Kuis
                                </button>
                            </div>
                            <!-- Decor -->
                            <div class="absolute right-0 bottom-0 opacity-20 transform translate-y-1/3 translate-x-1/4">
                                <svg class="w-64 h-64" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z" />
                                </svg>
                            </div>
                        </div>

                        <!-- Stats Overview -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Skor Total -->
                            <div class="glass-panel p-6 rounded-2xl flex items-center gap-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-slate-500 dark:text-slate-400 font-medium">Total Skor</p>
                                    <p class="text-2xl font-black text-slate-800 dark:text-slate-100"
                                        x-text="stats.score"></p>
                                </div>
                            </div>
                            <!-- Materi Dibaca -->
                            <div class="glass-panel p-6 rounded-2xl flex items-center gap-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 flex items-center justify-center">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-slate-500 dark:text-slate-400 font-medium">Materi Selesai</p>
                                    <p class="text-2xl font-black text-slate-800 dark:text-slate-100"
                                        x-text="stats.completed"></p>
                                </div>
                            </div>
                            <!-- Peringkat -->
                            <div class="glass-panel p-6 rounded-2xl flex items-center gap-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 flex items-center justify-center">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-slate-500 dark:text-slate-400 font-medium">Peringkat Global
                                    </p>
                                    <p class="text-2xl font-black text-slate-800 dark:text-slate-100"
                                        x-text="stats.rank"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: MATERI -->
                    <div x-show="currentView === 'materi'" x-cloak class="space-y-4 md:space-y-6">
                        <div class="flex justify-between items-center mb-1 md:mb-6">
                            <div>
                                <h3 class="text-2xl font-black text-slate-900 dark:text-slate-100">üìö Materi Belajar
                                </h3>
                                <p class="hidden md:block text-slate-500 dark:text-slate-400 text-sm mt-1">Pelajari
                                    bahasa Jepang dari
                                    berbagai modul</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <template x-for="item in contentList" :key="item.id">
                                <div @click="viewContent(item.id)"
                                    class="glass-panel p-4 md:p-6 rounded-2xl hover:scale-[1.01] active:scale-[0.98] transition-all duration-300 border-l-4 border-blue-500 cursor-pointer group relative overflow-hidden">

                                    <!-- Decorative background blob -->
                                    <div
                                        class="absolute -right-4 -top-4 w-24 h-24 bg-blue-500/5 rounded-full blur-2xl group-hover:bg-blue-500/10 transition-colors">
                                    </div>

                                    <div class="flex flex-col h-full relative z-10">
                                        <div class="flex justify-between items-center mb-2 md:mb-3">
                                            <span
                                                class="px-2.5 py-1 rounded-lg text-[10px] md:text-xs font-bold bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-800">Reading</span>
                                            <span
                                                class="text-[10px] md:text-xs text-slate-400 font-medium flex items-center gap-1">
                                                <svg class="w-3 h-3" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                </svg>
                                                <span x-text="item.date"></span>
                                            </span>
                                        </div>

                                        <h4 class="text-base md:text-lg font-bold text-slate-800 dark:text-slate-100 mb-1.5 line-clamp-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"
                                            x-text="item.title"></h4>

                                        <p class="text-xs md:text-sm text-slate-500 dark:text-slate-400 line-clamp-2 mb-3 leading-relaxed"
                                            x-text="item.body"></p>

                                        <div
                                            class="mt-auto flex justify-end items-center gap-1 text-blue-600 dark:text-blue-400 text-xs md:text-sm font-bold opacity-0 group-hover:opacity-100 md:opacity-100 transition-all duration-300 transform translate-x-2 group-hover:translate-x-0">
                                            <span>Baca Selengkapnya</span>
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M17 8l4 4m0 0l-4 4m4-4H3" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <!-- Empty State -->
                            <div x-show="contentList.length === 0" class="col-span-full py-12 text-center">
                                <p class="text-slate-400">Belum ada materi untuk saat ini.</p>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: SOAL -->
                    <div x-show="currentView === 'soal'" x-cloak class="space-y-4 md:space-y-6">
                        <div class="flex justify-between items-center mb-1 md:mb-6">
                            <div>
                                <h3 class="text-2xl font-black text-slate-900 dark:text-slate-100">üìù Kuis
                                </h3>
                                <p class="hidden md:block text-slate-500 dark:text-slate-400 text-sm mt-1">Uji
                                    kemampuanmu dengan
                                    mengerjakan soal</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 gap-4">
                            <template x-for="quiz in soalList" :key="quiz.id">
                                <div
                                    class="glass-panel p-5 rounded-2xl flex flex-col md:flex-row items-start md:items-center justify-between group hover:bg-white/90 dark:hover:bg-slate-700/60 transition-colors gap-4">
                                    <div class="flex items-center gap-4 w-full md:w-auto">
                                        <div
                                            class="w-12 h-12 rounded-xl bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 flex items-center justify-center group-hover:scale-110 transition-transform shrink-0">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                                            </svg>
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-slate-800 dark:text-slate-100 text-lg"
                                                x-text="quiz.title"></h4>
                                            <div class="flex items-center gap-2 mt-1">
                                                <span
                                                    class="text-xs font-medium px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-700 text-slate-500"
                                                    x-text="quiz.questions + ' Soal'"></span>
                                                <span x-show="isQuizDone(quiz.id)"
                                                    class="text-[10px] font-bold px-2 py-0.5 rounded bg-green-100 text-green-600 border border-green-200 flex items-center gap-1">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2" d="M5 13l4 4L19 7" />
                                                    </svg>
                                                    Selesai
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-end gap-3 w-full md:w-auto">
                                        <a x-show="isQuizDone(quiz.id)"
                                            :href="quiz.link + '?quizId=' + quiz.id + '&mode=review'" target="_blank"
                                            class="px-4 py-2.5 rounded-xl font-bold text-sm bg-amber-100 text-amber-700 hover:bg-amber-200 transition-colors flex items-center gap-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                            </svg>
                                            <span class="inline">Lihat Jawaban</span>
                                        </a>

                                        <button @click="openQuizModal(quiz)"
                                            class="px-5 py-2.5 rounded-xl font-bold text-sm shadow-lg active:scale-95 transition-all flex items-center gap-2"
                                            :class="isQuizDone(quiz.id) ? 'bg-white border-2 border-slate-100 text-slate-600 hover:border-slate-300 hover:bg-slate-50 shadow-sm' : 'bg-indigo-600 hover:bg-indigo-700 text-white shadow-indigo-500/20'">
                                            <template x-if="isQuizDone(quiz.id)">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                </svg>
                                            </template>
                                            <span x-text="isQuizDone(quiz.id) ? 'Ulangi' : 'Mulai'"></span>
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- VIEW: LEADERBOARD -->
                    <div x-show="currentView === 'leaderboard'" x-cloak class="space-y-4 md:space-y-6">
                        <div class="mb-1 md:mb-6">
                            <h3 class="text-2xl font-black text-slate-900 dark:text-slate-100">üèÜ Peringkat Siswa</h3>
                            <p class="hidden md:block text-slate-500 dark:text-slate-400 text-sm mt-1">Lihat siapa yang
                                paling rajin
                                belajar!</p>
                        </div>

                        <div class="glass-panel rounded-2xl overflow-hidden">
                            <table class="w-full">
                                <thead class="bg-slate-50 dark:bg-slate-700/50 text-left">
                                    <tr>
                                        <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Rank</th>
                                        <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Siswa</th>
                                        <th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase text-right">Skor
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
                                    <template x-for="(user, index) in leaderboard" :key="index">
                                        <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/30">
                                            <td class="px-6 py-4">
                                                <div class="w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm text-white"
                                                    :class="index === 0 ? 'bg-yellow-400' : index === 1 ? 'bg-slate-400' : index === 2 ? 'bg-orange-400' : 'bg-slate-200 dark:bg-slate-700 text-slate-500'">
                                                    <span x-text="index + 1"></span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 font-semibold text-slate-700 dark:text-slate-200"
                                                x-text="user.fullName || user.username"></td>
                                            <td class="px-6 py-4 text-right font-bold text-blue-600 dark:text-blue-400"
                                                x-text="user.score"></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- VIEW: REPORT -->
                    <div x-show="currentView === 'report'" x-cloak class="space-y-4 md:space-y-6">
                        <div class="mb-1 md:mb-6">
                            <h3 class="text-2xl font-black text-slate-900 dark:text-slate-100">üì¢ Laporan & Saran</h3>
                            <p class="hidden md:block text-slate-500 dark:text-slate-400 text-sm mt-1">Bantu kami
                                meningkatkan kualitas
                                materi dan aplikasi</p>
                        </div>

                        <div class="glass-panel p-8 rounded-2xl max-w-2xl">
                            <form @submit.prevent="submitReport" class="space-y-6">
                                <div>
                                    <label
                                        class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Subject</label>
                                    <input type="text" x-model="reportForm.subject"
                                        placeholder="Contoh: Kesalahan di materi Hiragana"
                                        class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 outline-none"
                                        required>
                                </div>
                                <div>
                                    <label
                                        class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Kategori</label>
                                    <select x-model="reportForm.category"
                                        class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 outline-none">
                                        <option value="bug">Lapor Bug / Error</option>
                                        <option value="materi">Kesalahan Materi</option>
                                        <option value="saran">Saran Fitur</option>
                                        <option value="lainnya">Lainnya</option>
                                    </select>
                                </div>
                                <div>
                                    <label
                                        class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Pesan</label>
                                    <textarea x-model="reportForm.message" rows="5"
                                        placeholder="Jelaskan detail laporanmu disini..."
                                        class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 outline-none"
                                        required></textarea>
                                </div>
                                <div class="pt-2">
                                    <button type="submit"
                                        class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-blue-500/20 hover:shadow-xl transition-all w-full md:w-auto">
                                        Kirim Laporan
                                    </button>
                                </div>
                                <p x-show="reportMsg" x-text="reportMsg"
                                    class="text-center font-semibold text-green-500 mt-4"></p>
                            </form>
                        </div>
                    </div>

                    <!-- VIEW: SETTING -->
                    <div x-show="currentView === 'setting'" x-cloak class="space-y-6">
                        <div class="mb-6">
                            <h3 class="text-2xl font-black text-slate-900 dark:text-slate-100">‚öôÔ∏è Pengaturan</h3>
                            <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">Atur profil akun kamu</p>
                        </div>

                        <div class="glass-panel rounded-2xl p-8 max-w-2xl">
                            <form @submit.prevent="updateProfile" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Nama
                                        Lengkap</label>
                                    <input type="text" x-model="profileForm.fullName"
                                        class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div>
                                    <label
                                        class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">Password
                                        Baru</label>
                                    <input type="password" x-model="profileForm.password"
                                        placeholder="Biarkan kosong jika tidak diganti"
                                        class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-blue-500 outline-none">
                                </div>
                                <div class="pt-4">
                                    <button type="submit"
                                        class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-blue-500/20 hover:shadow-xl transition-all w-full md:w-auto">
                                        Simpan Perubahan
                                    </button>
                                </div>
                                <p x-show="profileMsg" x-text="profileMsg"
                                    class="text-center font-semibold text-green-500 mt-4"></p>
                            </form>
                        </div>
                    </div>
                </div>
        </div>

        <!-- Content View Modal -->
        <div x-show="viewModalOpen" class="fixed inset-0 z-[90] flex items-center justify-center p-4" x-cloak>
            <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" @click="closeViewModal()">
            </div>
            <div class="bg-white dark:bg-slate-800 w-full max-w-2xl rounded-3xl shadow-2xl relative z-10 flex flex-col max-h-[90vh] overflow-hidden transform transition-all"
                x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
                x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95">

                <!-- Modal Header -->
                <div
                    class="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50">
                    <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100" x-text="viewContentData.title">
                    </h3>
                    <button @click="closeViewModal()"
                        class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="p-8 overflow-y-auto flex-1 prose dark:prose-invert max-w-none min-h-[300px]">
                    <template x-if="viewContentData.body">
                        <div class="whitespace-pre-line text-slate-600 dark:text-slate-300 leading-relaxed"
                            x-text="viewContentData.body"></div>
                    </template>
                    <template x-if="!viewContentData.body">
                        <div
                            class="flex flex-col items-center justify-center h-full text-slate-400 dark:text-slate-500 italic pb-8">
                            <svg class="w-16 h-16 mb-4 opacity-50" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <p>Belum ada konten materi yang tersedia untuk judul ini.</p>
                        </div>
                    </template>
                </div>

                <!-- Modal Footer -->
                <div class="p-6 border-t border-slate-200 dark:border-slate-700 flex justify-end">
                    <button @click="closeViewModal()"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-xl font-bold shadow-lg shadow-blue-500/25 hover:shadow-xl active:scale-95 transition-all">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Start Confirmation Modal -->
    <div x-show="quizModalOpen" x-cloak class="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" @click="quizModalOpen = false"></div>
        <div x-show="quizModalOpen" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
            class="relative w-full max-w-md bg-white dark:bg-slate-800 rounded-3xl shadow-2xl overflow-hidden border border-slate-100 dark:border-slate-700">

            <div class="p-8 text-center">
                <div
                    class="w-20 h-20 bg-indigo-100 dark:bg-indigo-900/30 rounded-full flex items-center justify-center mx-auto mb-6 text-indigo-600 dark:text-indigo-400">
                    <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                </div>
                <h3 class="text-2xl font-black text-slate-800 dark:text-slate-100 mb-2" x-text="selectedQuiz?.title">
                </h3>
                <p class="text-slate-500 dark:text-slate-400 mb-8">Kamu akan memulai kuis ini di halaman baru. Pastikan
                    koneksi internet lancar.</p>

                <div class="grid grid-cols-2 gap-4">
                    <button @click="quizModalOpen = false"
                        class="py-3 rounded-xl font-bold text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                        Batal
                    </button>
                    <a :href="selectedQuiz?.link + '?quizId=' + selectedQuiz?.id" target="_blank"
                        @click="quizModalOpen = false"
                        class="py-3 rounded-xl font-bold bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg shadow-indigo-500/20 transition-all active:scale-95 flex items-center justify-center gap-2">
                        <span>Mulai Mengerjakan</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </div>
    </main>
    </div>

    <!-- Bottom Navigation (Mobile Only) -->
    <div
        class="md:hidden fixed bottom-0 left-0 right-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur-xl border-t border-slate-200 dark:border-slate-800 z-[100] pb-safe">
        <div class="flex justify-around items-center px-2 py-2">
            <template x-for="item in navItems" :key="item.id">
                <button @click="currentView = item.id; window.scrollTo({top: 0, behavior: 'smooth'})"
                    class="relative flex flex-col items-center justify-center p-2 rounded-2xl transition-all duration-300 w-16 group"
                    :class="currentView === item.id ? 'text-blue-600 dark:text-blue-400 scale-110' : 'text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300'">

                    <!-- Active Indicator -->
                    <div x-show="currentView === item.id" x-transition:enter="transition ease-out duration-200"
                        x-transition:enter-start="opacity-0 scale-50" x-transition:enter-end="opacity-100 scale-100"
                        class="absolute -top-1 w-8 h-1 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full shadow-blue-500/50 shadow-sm">
                    </div>

                    <!-- Icon -->
                    <div class="relative p-1">
                        <span x-html="item.icon" class="w-6 h-6 block transition-transform duration-300"
                            :class="currentView === item.id ? '-translate-y-0.5' : ''"></span>

                        <!-- Glow effect for active -->
                        <div x-show="currentView === item.id"
                            class="absolute inset-0 bg-blue-500/20 dark:bg-blue-400/20 blur-lg rounded-full animate-pulse-slow">
                        </div>
                    </div>

                    <!-- Label -->
                    <span class="text-[10px] font-bold mt-0.5 tracking-wide transition-colors" x-text="item.label"
                        :class="currentView === item.id ? 'text-blue-600 dark:text-blue-400' : 'text-slate-500 dark:text-slate-500'"></span>
                </button>
            </template>
        </div>
    </div>
    </div>

    <script>
        function userDashboard() {
            return {
                darkMode: localStorage.getItem('darkMode') === 'true',
                currentView: 'dashboard',
                currentUser: null,

                contentList: [],
                soalList: [],
                leaderboard: [],
                stats: { score: 0 },

                viewModalOpen: false,
                viewContentData: { title: '', body: '' },
                quizModalOpen: false,
                selectedQuiz: null,

                profileForm: { fullName: '', password: '' },
                profileMsg: '',

                reportForm: { subject: '', category: 'bug', message: '' },
                reportMsg: '',

                navItems: [
                    { id: 'dashboard', label: 'Dashboard', icon: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>' },
                    { id: 'materi', label: 'Materi', icon: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>' },
                    { id: 'soal', label: 'Kuis', icon: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>' },
                    { id: 'leaderboard', label: 'Peringkat', icon: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>' },
                    { id: 'report', label: 'Laporan', icon: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" /></svg>' }
                ],

                loading: true,

                async initDashboard() {
                    // Check auth
                    this.currentUser = await dbRef.getCurrentUser();
                    if (!this.currentUser) {
                        alert("Silakan login ulang");
                        window.location.href = '../../auth.html';
                        return;
                    }

                    this.profileForm.fullName = this.currentUser.fullName || '';
                    if (this.darkMode) document.documentElement.classList.add('dark');

                    await this.refreshData();

                    window.addEventListener('focus', () => {
                        this.refreshData();
                    });
                    this.loading = false;
                },

                async refreshData() {
                    // Refresh user data (score etc)
                    this.currentUser = await dbRef.getCurrentUser();

                    // Update stats from currentUser profile
                    if (this.currentUser) {
                        this.stats.score = this.currentUser.score || 0;
                        this.stats.completed = this.currentUser.completedQuizzes || 0;
                    }

                    // Fetch Quizzes from DB
                    try {
                        const quizzes = await dbRef.getQuizList();
                        this.soalList = quizzes.filter(q => q.status === 'publish');
                    } catch (e) {
                        console.error("Error fetching quizzes", e);
                        this.soalList = [];
                    }

                    // Fetch Content
                    try {
                        const contents = await dbRef.getContentList();
                        this.contentList = contents.filter(c => c.status === 'publish').map(c => ({
                            ...c,
                            date: new Date(c.date || Date.now()).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' })
                        }));
                    } catch (e) {
                        console.error("Error fetching content", e);
                        this.contentList = [];
                    }

                    // Calculate Leaderboard & Rank
                    try {
                        const users = await dbRef.getAllUsers();
                        const sortedUsers = [...users].sort((a, b) => (b.score || 0) - (a.score || 0));

                        this.leaderboard = sortedUsers.slice(0, 5);

                        // Find rank
                        if (this.currentUser) {
                            const myIndex = sortedUsers.findIndex(u => u.id === this.currentUser.id);
                            this.stats.rank = myIndex !== -1 ? myIndex + 1 : '-';
                        }
                    } catch (e) {
                        console.error("Error fetching leaderboard", e);
                    }
                },

                viewContent(id) {
                    const item = this.contentList.find(c => c.id === id);
                    if (item) {
                        this.viewContentData = { ...item };
                        this.viewModalOpen = true;
                    }
                },

                closeViewModal() {
                    this.viewModalOpen = false;
                },

                openQuizModal(quiz) {
                    this.selectedQuiz = quiz;
                    this.quizModalOpen = true;
                },

                isQuizDone(quizId) {
                    if (!this.currentUser || !this.currentUser.history) return false;
                    return this.currentUser.history.includes(quizId);
                },

                toggleTheme() {
                    this.darkMode = !this.darkMode;
                    localStorage.setItem('darkMode', this.darkMode);
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                },

                updateProfile() {
                    const data = { fullName: this.profileForm.fullName };
                    if (this.profileForm.password && this.profileForm.password.length >= 6) {
                        data.password = this.profileForm.password;
                    }

                    const res = dbRef.updateUser(this.currentUser.id, data);
                    if (res.success) {
                        this.currentUser = res.user;
                        this.profileMsg = 'Profil berhasil diupdate!';
                        setTimeout(() => this.profileMsg = '', 3000);
                    }
                },

                submitReport() {
                    // Mock submission since we don't have a report collection yet
                    console.log('Report submitted:', this.reportForm);
                    this.reportMsg = 'Laporan berhasil dikirim! Terima kasih atas masukanmu.';
                    this.reportForm = { subject: '', category: 'bug', message: '' };
                    setTimeout(() => this.reportMsg = '', 4000);
                },

                logout() {
                    dbRef.logout();
                    window.location.href = '../../auth.html';
                }
            }
        }
    </script>
</body>

</html>
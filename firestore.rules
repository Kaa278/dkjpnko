rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // USERS COLLECTION
    match /users/{userId} {
      // 1. Siapa saja boleh baca (untuk login & leaderboard)
      allow read: if true; 
      
      // 2. CREATE: Izinkan siapa saja membuat akun (Register Siswa)
      allow create: if true;

      // 3. UPDATE: Izinkan update untuk siapa saja
      // (Karena siswa tidak login via Firebase Auth, mereka dianggap "guest".
      // Kita perlu izinkan update agar skor & progress bisa disimpan).
      allow update: if true;
      
      // 4. DELETE: Hanya Admin asli (Firebase Auth) yang boleh hapus user
      allow delete: if request.auth != null;
    }
    
    // Default Rule untuk koleksi lain (Quizzes, Content, dll)
    // Read: Semua boleh
    // Write: Hanya Admin (Firebase Auth)
    match /{document=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
  }
}
